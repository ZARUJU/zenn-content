---
title: "OpenAIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã–ã£ãã‚Šã—ãŸä½¿ã„æ–¹"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["openai", "python", "jupyternotebook"]
published: true
---

# èª¬æ˜ã—ãªã„ã“ã¨

- OpenAI ã® APIKEY ã®å–å¾—æ–¹æ³•
- Python ã®ç’°å¢ƒæ§‹ç¯‰
- JupyterNotebook ã®ç’°å¢ƒæ§‹ç¯‰

# ä»•çµ„ã¿

- æº–å‚™
  1.  ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
  2.  ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆä½œæˆ
  3.  ã‚¹ãƒ¬ãƒƒãƒ‰ä½œæˆ
- å®Ÿè¡Œ
  1.  ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½åŠ ï¼ˆè³ªå•ï¼‰
  2.  å›ç­”ç”Ÿæˆ
  3.  çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ã¦é–²è¦§

# ä½¿ã„æ–¹

ãã‚Œãã‚Œã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’ Notebook ã®ã‚³ãƒ¼ãƒ‰ã‚»ãƒ«ã¨åŒã˜ã‚ˆã†ã«åˆ†ã‘ã¦é…ç½®ã™ã‚‹ã€‚

æœ€åˆã®ï¼“ã¤ã®ã‚»ãƒ«ã‚’å®Ÿè¡Œå¾Œã€è³ªå•ã®ãŸã³ã«ã†ã—ã‚ï¼’ã¤ã‚’å®Ÿè¡Œã—ã€è³ªå•ã‚’è¡Œã†ã€‚
ã‚¹ãƒ¬ãƒƒãƒ‰ã®ä½œæˆã‚’å®Ÿè¡Œã—ç›´ã™ã“ã¨ã§ã€ä¼šè©±ã‚’ãƒªã‚»ãƒƒãƒˆã§ãã‚‹ã€‚

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```python:ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ
from openai import OpenAI

client = OpenAI(api_key="sk-ãƒ»ãƒ»ãƒ»")
```

```python:ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®ä½œæˆ
assistant = client.beta.assistants.create(
    # ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®å®šç¾©ï¼Ÿ
    instructions="""
    ã‚ãªãŸã¯å„ªç§€ãªãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã§ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹é–‹ç™ºã®ãŠæ‰‹ä¼ã„ã‚’ã—ã¦ãã ã•ã„ã€‚
    """,
    model="gpt-4-1106-preview",
)
assistant_id = assistant.id
```

```python:ã‚¹ãƒ¬ãƒƒãƒ‰ã®ä½œæˆ
thread = client.beta.threads.create()
thread_id = thread.id
```

```python:è³ªå•ã¨å›ç­”ç”Ÿæˆ
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿½åŠ 
message = client.beta.threads.messages.create(
    thread_id=thread_id, role="user", content=input("è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„")
)

run = client.beta.threads.runs.create(
    thread_id=thread_id,
    assistant_id=assistant_id,
)
```

```python:å›ç­”ã‚’ç¢ºèªã—ã¦ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
# ã‚¹ãƒ¬ãƒƒãƒ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã®ç¢ºèª

# ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®IDã‚’åˆ©ç”¨ã—ã¦ã€ä¸€æ„ã«ãªã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹
result_file = f"{thread_id}_{assistant_id}.md"

messages = client.beta.threads.messages.list(thread_id=thread_id)
messages_list = [message for message in messages]

# ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆæœŸåŒ–
with open(result_file, "w") as file:
    file.truncate(0)

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰ã§é–‹ã
with open(result_file, 'w') as file:
    # IDã®æƒ…å ±ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€
    file.write(f'Thread_IDï¼š{thread_id}\n\n')
    file.write(f'Assistant_IDï¼š{assistant_id}\n\n')
    file.write('----\n')

    for message in reversed(messages_list):
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æƒ…å ±ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€
        file.write(f'{message.role}ï¼š{message.content[0].text.value}\n\n')

```
